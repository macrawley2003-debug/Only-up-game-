<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Only Up 3D</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #fff;
      font-family: sans-serif;
      z-index: 100;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
</head>
<body>
<div id="info">Use W/A/S/D to move, SPACE to jump. Climb to the top!</div>
<script>
  // Scene, camera, renderer
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Lights
  const ambient = new THREE.AmbientLight(0xffffff, 0.8);
  scene.add(ambient);
  const dirLight = new THREE.DirectionalLight(0xffffff, 0.6);
  dirLight.position.set(0, 50, 50);
  scene.add(dirLight);

  // Player
  const playerGeometry = new THREE.BoxGeometry(1, 2, 1);
  const playerMaterial = new THREE.MeshStandardMaterial({ color: 0xffaa00 });
  const player = new THREE.Mesh(playerGeometry, playerMaterial);
  // spawn above first platform
  player.position.set(0, 2, 0);
  scene.add(player);

  // Platforms
  const platforms = [];
  const platGeom = new THREE.BoxGeometry(5, 1, 5);
  const platMat  = new THREE.MeshStandardMaterial({ color: 0x004400 });
  for (let i = 0; i < 20; i++) {
    const platform = new THREE.Mesh(platGeom, platMat);
    const y = i * 5;
    let x, z;
    if (i === 0) {
      x = 0;
      z = 0;
    } else {
      const angle = i * 0.5;
      x = Math.sin(angle) * 8;
      z = Math.cos(angle) * 8;
    }
    platform.position.set(x, y, z);
    scene.add(platform);
    platforms.push(platform);
  }
  const goal = platforms[platforms.length - 1];

  // Controls state
  const keys = {};
  window.addEventListener('keydown', (e) => { keys[e.code] = true; });
  window.addEventListener('keyup', (e) => { keys[e.code] = false; });

  // Physics variables
  let velocityY = 0;
  const gravity = -20;
  const jumpStrength = 10;
  let canJump = false;

  // Resize handler
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });

  function animate() {
    requestAnimationFrame(animate);

    // Horizontal movement
    const speed = 0.15;
    if (keys['KeyW']) player.position.z -= speed;
    if (keys['KeyS']) player.position.z += speed;
    if (keys['KeyA']) player.position.x -= speed;
    if (keys['KeyD']) player.position.x += speed;

    // Apply gravity
    velocityY += gravity * 0.016;
    player.position.y += velocityY * 0.016;

    // Simple collision detection with platforms
    canJump = false;
    platforms.forEach((plat) => {
      const yDist = player.position.y - plat.position.y;
      if (Math.abs(yDist) < 1.2 &&
          Math.abs(player.position.x - plat.position.x) < 3 &&
          Math.abs(player.position.z - plat.position.z) < 3 &&
          velocityY <= 0) {
        player.position.y = plat.position.y + 1.5;
        velocityY = 0;
        canJump = true;
      }
    });

    // Jump input
    if (keys['Space'] && canJump) {
      velocityY = jumpStrength;
    }

    // Keep player above ground by resetting to spawn above first platform
    if (player.position.y < -10) {
      player.position.set(0, 2, 0);
      velocityY = 0;
    }

    // Update camera to follow player
    camera.position.x = player.position.x;
    camera.position.y = player.position.y + 5;
    camera.position.z = player.position.z + 10;
    camera.lookAt(player.position);

    // Check win condition
    if (player.position.distanceTo(goal.position) < 2) {
      alert('ðŸŒ• You made it to the top! Game completed!');
      player.position.set(0, 2, 0);
      velocityY = 0;
    }

    renderer.render(scene, camera);
  }

  animate();
</script>
</body>
</html>
